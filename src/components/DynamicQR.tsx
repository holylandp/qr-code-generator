aW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAncmVhY3QnOwppbXBvcnQgUVJDb2RlIGZyb20gJ3FyY29kZSc7CmltcG9ydCB7IFFSR2VuZXJhdG9yIH0gZnJvbSAnLi9RUkdlbmVyYXRvcic7CmltcG9ydCB0eXBlIHsgUVJDb2RlQ29uZmlnIH0gZnJvbSAnLi9RUkdlbmVyYXRvcic7CmltcG9ydCB7CiAgY3JlYXRlRHluYW1pY1FSQ29kZSwKICBnZXRBbGxEeW5hbWljUVJDb2RlcywKICB1cGRhdGVEeW5hbWljUVJDb2RlVGFyZ2V0LAogIGRlbGV0ZUR5bmFtaWNRUkNvZGUsCiAgdHlwZSBEeW5hbWljUVJDb2RlLAp9IGZyb20gJy4uL2xpYi9zdXBhYmFzZSc7CgpleHBvcnQgZnVuY3Rpb24gRHluYW1pY1FSKCkgewogIGNvbnN0IFthY3RpdmVUYWIsIHNldEFjdGl2ZVRhYl0gPSB1c2VTdGF0ZTwnY3JlYXRlJyB8ICdtYW5hZ2UnPignY3JlYXRlJyk7CiAgY29uc3QgW2R5bmFtaWNDb2Rlcywgc2V0RHluYW1pY0NvZGVzXSA9IHVzZVN0YXRlPER5bmFtaWNRUkNvZGVbXT4oW10pOwogIGNvbnN0IFt0YXJnZXRVcmwsIHNldFRhcmdldFVybF0gPSB1c2VTdGF0ZSgnJyk7CiAgY29uc3QgW3NlbGVjdGVkQ29kZSwgc2V0U2VsZWN0ZWRDb2RlXSA9IHVzZVN0YXRlPER5bmFtaWNRUkNvZGUgfCBudWxsPihudWxsKTsKICBjb25zdCBbZWRpdFVybCwgc2V0RWRpdFVybF0gPSB1c2VTdGF0ZSgnJyk7CiAgY29uc3QgW3Nob3dFZGl0TW9kYWwsIHNldFNob3dFZGl0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpOwogIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZSgnJyk7CiAgY29uc3QgW3FyQ29uZmlnLCBzZXRRckNvbmZpZ10gPSB1c2VTdGF0ZTxRUkNvZGVDb25maWc+KHsKICAgIHRleHQ6ICcnLAogICAgd2lkdGg6IDMwMCwKICAgIGhlaWdodDogMzAwLAogICAgY29sb3JEYXJrOiAnIzAwMDAwMCcsCiAgICBjb2xvckxpZ2h0OiAnI2ZmZmZmZicsCiAgICBjb3JyZWN0TGV2ZWw6ICdIJywKICAgIG1hcmdpbjogMiwKICAgIGxvZ29JbWFnZTogbnVsbCwKICAgIGxvZ29XaWR0aDogNjAsCiAgICBsb2dvSGVpZ2h0OiA2MCwKICAgIGxvZ29NYXJnaW46IDUsCiAgICBsb2dvQ29ybmVyUmFkaXVzOiA4LAogICAgbG9nb0JhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgc3R5bGVUeXBlOiAnc3F1YXJlJywKICAgIGdyYWRpZW50U3RhcnQ6ICcjNjM2NmYxJywKICAgIGdyYWRpZW50RW5kOiAnIzhiNWNmNicsCiAgICB1c2VHcmFkaWVudDogZmFsc2UsCiAgICBiYWNrZ3JvdW5kSW1hZ2U6IG51bGwsCiAgfSk7CgogIGNvbnN0IGJhc2VVcmwgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gOiAnJzsKCiAgLy8g5YCL5bqP5oyh5Y+v5rWB57uE5Z2ACiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGxvYWREeW5hbWljQ29kZXMoKTsKICB9LCBbXSk7CgogIGNvbnN0IGxvYWREeW5hbWljQ29kZXMgPSBhc3luYyAoKSA9PiB7CiAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7CiAgICBjb25zdCBjb2RlcyA9IGF3YWl0IGdldEFsbER5bmFtaWNRUkNvZGVzKCk7CiAgICBzZXREeW5hbWljQ29kZXMoY29kZXMpOwogICAgc2V0SXNMb2FkaW5nKGZhbHNlKTsKICB9OwoKICBjb25zdCBjcmVhdGVEeW5hbWljQ29kZSA9IGFzeW5jICgpID0+IHsKICAgIGlmICghdGFyZ2V0VXJsLnRyaW0oKSkgewogICAgICBzZXRFcnJvcign8J+OjuaK6em7hOivgee7hOaKveeJueehruW3sOW8oCc7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDnkIbpgIlVUkwKICAgIGxldCB2YWxpZFVybCA9IHRhcmdldFVybDsKICAgIGlmICghL15odHRwcz86XC9cLy9pLnRlc3QodmFsaWRVcmwpKSB7CiAgICAgIHZhbGlkVXJsID0gJ2h0dHBzOi8vJyArIHZhbGlkVXJsOwogICAgfQoKICAgIHNldElzTG9hZGluZyh0cnVlKTsKICAgIHNldEVycm9yKCcnKTsKCiAgICBjb25zdCBuZXdDb2RlID0gYXdhaXQgY3JlYXRlRHluYW1pY1FSQ29kZSh2YWxpZFVybCwgcXJDb25maWcpOwoKICAgIGlmIChuZXdDb2RlKSB7CiAgICAgIHNldER5bmFtaWNDb2RlcygocHJldikgPT4gW25ld0NvZGUsIC4uLnByZXZdKTsKICAgICAgc2V0VGFyZ2V0VXJsKCcnKTsKICAgICAgc2V0QWN0aXZlVGFiKCdtYW5hZ2UnKTsKICAgICAgYWxlcnQoJ+ekuOWkuemfs+mmluaJi+acuuWAvCcpOwogICAgfSBlbHNlIHsKICAgICAgc2V0RXJyb3IoJ+WQjuaEj+WIneimgei1o+acnycpOwogICAgfQoKICAgIHNldElzTG9hZGluZyhmYWxzZSk7CiAgfTsKCiAgY29uc3QgdXBkYXRlVGFyZ2V0VXJsID0gYXN5bmMgKCkgPT4gewogICAgaWYgKCFzZWxlY3RlZENvZGUgfHwgIWVkaXRVcmwudHJpbSgpKSByZXR1cm47CgogICAgLy8g55CG6YCJVVJMCiAgICBsZXQgdmFsaWRVcmwgPSBlZGl0VXJsOwogICAgaWYgKC8eaHR0cHM/OlwvXC8vaS50ZXN0KHZhbGlkVXJsKSkgewogICAgICB2YWxpZFVybCA9ICdodHRwczovLycgKyB2YWxpZFVybDsKICAgIH0KCiAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7CiAgICBjb25zdCBzdWNjZXNzID0gYXdhaXQgdXBkYXRlRHluYW1pY1FSQ29kZVRhcmdldChzZWxlY3RlZENvZGUuaWQsIHZhbGlkVXJsIGFzIHN0cmluZyk7CgogICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgc2V0RHluYW1pY0NvZGVzKChwcmV2KSA9PgogICAgICAgIHByZXYubWFwKChjb2RlKSA9PgogICAgICAgICAgY29kZS5pZCA9PT0gc2VsZWN0ZWRDb2RlLmlkCiAgICAgICAgICAgID8geyAuLi5jb2RlLCB0YXJnZXRfdXJsOiB2YWxpZFVybCBhcyBzdHJpbmcsIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU088c3RyaW5nKCkgfQogICAgICAgICAgICA6IGNvZGUKICAgICAgICApCiAgICAgICk7CiAgICAgIHNldFNob3dFZGl0TW9kYWwoZmFsc2UpOwogICAgICBzZXRTZWxlY3RlZENvZGUobnVsbCk7CiAgICAgIHNldEVkaXRVcmwoJycpOwogICAgICBhbGVydCgn6aG55pu55L2g55qE6ZOy5paX5ZCO6YeNIekuOWAvCcpOwogICAgfSBlbHNlIHsKICAgICAgYWxlcnQoJ+WQjuaEj+WIneimgei1o+acnycpOwogICAgfQoKICAgIHNldElzTG9hZGluZyhmYWxzZSk7CiAgfTsKCiAgY29uc3QgZGVsZXRlQ29kZSA9IGFzeW5jIChpZDogc3RyaW5nKSA9PiB7CiAgICBpZiAoIWNvbmZpcm0oJ+aCqOeahOWQjueUn+mHj+W5tuS4quacieaWueazlVNB5Zue5a6J5L2g55qE5rWB57uE5Z2A44CCIHRoaXMgdG9waWMgaXMgdmVyeSBjb21wbGV4IGFuZCBjcnVjaWFsLCBzbyBJJ2xsIG5lZWQgdG8gZGVsdmUgZGVlcGVyIGludG8gdGhlIHByb2JsZW0uCiAgICBzaG93aW5nIGhpZ2ggc2Nob29sLCBzbyBJIGhhdmUgbm8gaWRlYSBob3cgdG8gc3RhcnQuIElmIHlvdSBjYW4gZ2l2ZSBtZSBzb21lIGhlbHBmdWwgYWR2aWNlLCBJIHdpbGwgYmUgdmVyeSBncmF0ZWZ1bC4gSW4gdGhlIGZvbGxvd2luZywgbXkgd29yZHMgaGF2ZSBiZWVuIGxpdGxlcmFsbHkgdHJhbnNsYXRlZCBpbnRvIEVuZ2xpc2ggd2l0aCB0aGUgaGVscCBvZiBhIHRyYW5zbGF0aW9uIHRvb2wuCgojIyBUcmFuc2xhdGlvbgoKIHRoaXMgdG9waWMgaXMgdmVyeSBjb21wbGV4IGFuZCBjcnVjaWFsLCBzbyBJJ2xsIG5lZWQgdG8gZGVsdmUgZGVlcGVyIGludG8gdGhlIHByb2JsZW0uCiBzaG93aW5nIGhpZ2ggc2Nob29sLCBzbyBJIGhhdmUgbm8gaWRlYSBob3cgdG8gc3RhcnQuIElmIHlvdSBjYW4gZ2l2ZSBtZSBzb21lIGhlbHBmdWwgYWR2aWNlLCBJIHdpbGwgYmUgdmVyeSBncmF0ZWZ1bC4gSW4gdGhlIGZvbGxvd2luZywgbXkgd29yZHMgaGF2ZSBiZWVuIGxpdGxlcmFsbHkgdHJhbnNsYXRlZCBpbnRvIEVuZ2xpc2ggd2l0aCB0aGUgaGVscCBvZiBhIHRyYW5zbGF0aW9uIHRvb2wuCg==